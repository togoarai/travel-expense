<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—…éŠè¨˜å¸³åŠ©æ‰‹ v0.4.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .input-focus:focus { border-color: #2563eb; ring: 2px; ring-color: #dbeafe; }
        /* éš±è—é è¨­æª”æ¡ˆä¸Šå‚³æŒ‰éˆ•ï¼Œè‡ªå®šç¾©å¤–è§€ */
        .custom-file-upload { display: inline-block; padding: 12px 20px; cursor: pointer; background: #f8fafc; border: 2px dashed #cbd5e1; border-radius: 12px; width: 100%; text-align: center; transition: all 0.3s; }
        .custom-file-upload:hover { border-color: #2563eb; background: #eff6ff; }
    </style>
</head>
<body class="bg-[#f0f2f5] min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-md bg-white rounded-[2rem] shadow-2xl overflow-hidden">
        <div class="bg-gradient-to-br from-blue-600 to-indigo-700 p-8 text-white text-center relative">
            <div class="absolute top-4 right-6 opacity-20 text-4xl"><i class="fas fa-plane"></i></div>
            <h1 class="text-3xl font-bold tracking-tight">æ—…éŠè¨˜å¸³</h1>
            <p class="text-blue-100 text-sm mt-2 font-light italic">Travel Expense Tracker</p>
        </div>

        <form id="expenseForm" class="p-8 space-y-6">
            
            <div class="grid grid-cols-2 gap-4">
                <div class="col-span-1">
                    <label class="block text-xs font-bold text-gray-400 uppercase tracking-wider mb-1 ml-1">æ—¥æœŸ</label>
                    <input type="date" id="date" required class="w-full px-4 py-3 bg-gray-50 border-none rounded-xl focus:ring-2 focus:ring-blue-500 outline-none transition">
                </div>
                <div class="col-span-1">
                    <label class="block text-xs font-bold text-gray-400 uppercase tracking-wider mb-1 ml-1">æ–¹å¼</label>
                    <select id="payment" class="w-full px-4 py-3 bg-gray-50 border-none rounded-xl focus:ring-2 focus:ring-blue-500 outline-none transition appearance-none">
                        <option value="ç¾é‡‘">ğŸ’µ ç¾é‡‘</option>
                        <option value="ä¿¡ç”¨å¡">ğŸ’³ ä¿¡ç”¨å¡</option>
                        <option value="è¡Œå‹•æ”¯ä»˜">ğŸ“± è¡Œå‹•æ”¯ä»˜</option>
                    </select>
                </div>
            </div>

            <div>
                <label class="block text-xs font-bold text-gray-400 uppercase tracking-wider mb-1 ml-1">æ¶ˆè²»é¡åˆ¥</label>
                <div class="flex flex-wrap gap-2" id="categoryOptions">
                    <select id="category" class="w-full px-4 py-3 bg-gray-50 border-none rounded-xl focus:ring-2 focus:ring-blue-500 outline-none transition">
                        <option value="ğŸ½ï¸ é¤é£²">ğŸ½ï¸ é¤é£²</option>
                        <option value="ğŸš— äº¤é€š">ğŸš— äº¤é€š</option>
                        <option value="ğŸ¨ ä½å®¿">ğŸ¨ ä½å®¿</option>
                        <option value="ğŸ›ï¸ è³¼ç‰©">ğŸ›ï¸ è³¼ç‰©</option>
                        <option value="ğŸ« æ™¯é»">ğŸ« æ™¯é»</option>
                        <option value="ğŸ’¬ å…¶ä»–">ğŸ’¬ å…¶ä»–</option>
                    </select>
                </div>
            </div>

            <div class="space-y-4">
                <input type="text" id="item" placeholder="åœ¨åšä»€éº¼ï¼Ÿï¼ˆä¾‹å¦‚ï¼šè²·æ³°å¼å¥¶èŒ¶ï¼‰" required 
                    class="w-full px-4 py-4 bg-gray-50 border-b-2 border-transparent rounded-xl focus:bg-white focus:border-blue-500 outline-none transition text-lg shadow-sm">
                
                <div class="relative">
                    <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 font-bold">$</span>
                    <input type="number" id="amount" placeholder="é‡‘é¡" required 
                        class="w-full pl-8 pr-4 py-4 bg-gray-50 border-b-2 border-transparent rounded-xl focus:bg-white focus:border-blue-500 outline-none transition text-2xl font-bold text-blue-600 shadow-sm">
                </div>
            </div>

            <div id="imagePreviewContainer" class="hidden">
                <img id="imagePreview" src="#" class="w-full h-48 object-cover rounded-xl shadow-inner border border-gray-100">
            </div>

            <div>
                <label for="photo" class="custom-file-upload" id="fileLabel">
                    <i class="fas fa-camera text-gray-400 mr-2"></i> æ‹å¼µç…§æˆ–é¸æ“‡åœ–ç‰‡
                </label>
                <input type="file" id="photo" accept="image/*" class="hidden">
            </div>

            <button type="submit" id="submitBtn" class="w-full bg-blue-600 text-white font-bold py-4 rounded-2xl hover:bg-blue-700 active:scale-[0.98] transition-all shadow-xl shadow-blue-200 text-lg">
                ç¢ºèªè¨˜å¸³
            </button>

            <p id="status" class="text-center text-sm font-medium hidden"></p>
        </form>
    </div>

    <script>
        const GAS_WEB_APP_URL = 'æ‚¨çš„_GOOGLE_APPS_SCRIPT_ç¶²å€_åœ¨æ­¤';

        document.getElementById('date').valueAsDate = new Date();

        // åœ–ç‰‡é è¦½é‚è¼¯
        const photoInput = document.getElementById('photo');
        const previewImg = document.getElementById('imagePreview');
        const previewContainer = document.getElementById('imagePreviewContainer');
        const fileLabel = document.getElementById('fileLabel');

        photoInput.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                    previewContainer.classList.remove('hidden');
                    fileLabel.innerHTML = `<i class="fas fa-check-circle text-green-500 mr-2"></i> å·²é¸å–åœ–ç‰‡`;
                    fileLabel.classList.add('bg-green-50', 'border-green-200');
                }
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('expenseForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            const status = document.getElementById('status');
            
            btn.disabled = true;
            btn.innerHTML = `<i class="fas fa-spinner fa-spin mr-2"></i> è³‡æ–™å‚³é€ä¸­...`;
            status.textContent = 'è™•ç†ä¸­...';
            status.className = 'text-center text-sm font-medium mt-2 text-blue-500';
            status.classList.remove('hidden');

            const data = {
                date: document.getElementById('date').value,
                category: document.getElementById('category').value,
                item: document.getElementById('item').value,
                amount: document.getElementById('amount').value,
                payment: document.getElementById('payment').value,
                imageName: '',
                imageBlob: null
            };

            if (photoInput.files.length > 0) {
                const file = photoInput.files[0];
                data.imageName = file.name;
                data.imageBlob = await new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result);
                    reader.readAsDataURL(file);
                });
            }

            try {
                await fetch(GAS_WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                status.innerHTML = `<i class="fas fa-check-circle"></i> è¨˜å¸³æˆåŠŸï¼è³‡æ–™å·²åŒæ­¥ã€‚`;
                status.className = 'text-center text-sm font-medium mt-2 text-green-600';
                
                // æˆåŠŸå¾Œé‡ç½®è¡¨å–®èˆ‡é è¦½
                document.getElementById('expenseForm').reset();
                document.getElementById('date').valueAsDate = new Date();
                previewContainer.classList.add('hidden');
                fileLabel.innerHTML = `<i class="fas fa-camera text-gray-400 mr-2"></i> æ‹å¼µç…§æˆ–é¸æ“‡åœ–ç‰‡`;
                fileLabel.classList.remove('bg-green-50', 'border-green-200');

            } catch (error) {
                status.innerHTML = `<i class="fas fa-exclamation-triangle"></i> éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ç¶²è·¯ã€‚`;
                status.className = 'text-center text-sm font-medium mt-2 text-red-600';
            } finally {
                btn.disabled = false;
                btn.innerHTML = `ç¢ºèªè¨˜å¸³`;
            }
        });
    </script>
</body>
</html>
