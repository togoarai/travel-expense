<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ—…éŠè¨˜å¸³åŠ©æ‰‹ v0.4.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');

        body {
            font-family: 'Noto Sans TC', sans-serif;
            /* è®“èƒŒæ™¯é¡è‰²èˆ‡ Header èåˆï¼Œæ¸›å°‘è¦–è¦ºæ–·å±¤ */
            background-color: #ffffff;
        }

        /* é‡å°è¡Œå‹•ç«¯å¾®èª¿ï¼šéš±è—æ»¾å‹•æ¢ */
        ::-webkit-scrollbar {
            display: none;
        }

        /* è‡ªå®šç¾©æª”æ¡ˆä¸Šå‚³æŒ‰éˆ•æ¨£å¼ */
        .custom-file-upload {
            display: inline-block;
            padding: 16px;
            cursor: pointer;
            background: #f8fafc;
            border: 2px dashed #cbd5e1;
            border-radius: 16px;
            width: 100%;
            text-align: center;
            transition: all 0.3s;
        }
    </style>
</head>

<body class="bg-white md:bg-slate-100 min-h-screen flex items-start justify-center">

    <div
        class="w-full max-w-md bg-white min-h-screen md:min-h-0 md:my-8 md:rounded-[2.5rem] md:shadow-2xl overflow-hidden flex flex-col">

        <div
            class="bg-gradient-to-br from-blue-600 to-indigo-700 p-8 pt-12 pb-10 text-white text-center relative shadow-lg">
            <div class="absolute top-6 right-8 opacity-20 text-5xl"><i class="fas fa-plane"></i></div>
            <h1 class="text-3xl font-bold tracking-tight">æ—…éŠè¨˜å¸³</h1>
            <p class="text-blue-100 text-sm mt-2 font-light tracking-widest">TRAVEL EXPENSE</p>
        </div>

        <form id="expenseForm" class="flex-grow p-6 md:p-8 space-y-6">

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 ml-1">æ—¥æœŸ</label>
                    <input type="date" id="date" required
                        class="w-full px-4 py-3 bg-gray-50 border-none rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none transition text-gray-700">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 ml-1">æ–¹å¼</label>
                    <select id="payment"
                        class="w-full px-4 py-3 bg-gray-50 border-none rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none transition appearance-none text-gray-700">
                        <option value="æ³°åœ‹å¸³æˆ¶">æ³°åœ‹å¸³æˆ¶</option>
                        <option value="ç¾é‡‘">ç¾é‡‘</option>
                        <option value="ä¿¡ç”¨å¡">ä¿¡ç”¨å¡</option>
                        <option value="è¡Œå‹•æ”¯ä»˜">è¡Œå‹•æ”¯ä»˜</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                </div>
            </div>

            <div>
                    <label class="block text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 ml-1">ä»˜æ¬¾äºº</label>
                    <select id="payer"
                        class="w-full px-4 py-3 bg-gray-50 border-none rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none transition appearance-none text-gray-700">
                        <option value="MARK">MARK</option>
                        <option value="AELX">ALEX</option>
                    </select>
                </div>
            
            <div>
                <label class="block text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 ml-1">é¡åˆ¥</label>
                <select id="category"
                    class="w-full px-4 py-3 bg-gray-50 border-none rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none transition text-gray-700">
                    <option value="ğŸ½ï¸ é¤é£²">ğŸ½ï¸ é¤é£²</option>
                    <option value="ğŸš— äº¤é€š">ğŸš— äº¤é€š</option>
                    <option value="ğŸ¨ ä½å®¿">ğŸ¨ ä½å®¿</option>
                    <option value="ğŸ›ï¸ è³¼ç‰©">ğŸ›ï¸ è³¼ç‰©</option>
                    <option value="ğŸ« æ™¯é»">ğŸ« æ™¯é»</option>
                    <option value="ğŸ’¬ å…¶ä»–">ğŸ’¬ å…¶ä»–</option>
                </select>
            </div>

            <div class="space-y-4">
                <div class="group">
                    <label
                        class="block text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 ml-1 font-semibold">é …ç›®</label>
                    <input type="text" id="item" placeholder="åœ¨åšä»€éº¼ï¼Ÿ" required
                        class="w-full px-4 py-4 bg-gray-50 border-b-2 border-transparent rounded-2xl focus:bg-white focus:border-blue-500 outline-none transition text-lg shadow-sm">
                </div>

                <div class="group">
                    <label
                        class="block text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 ml-1 font-semibold">é‡‘é¡</label>
                    <div class="relative">
                        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-blue-300 font-bold text-xl">$</span>
                        <input type="number" id="amount" placeholder="0" required
                            class="w-full pl-10 pr-4 py-4 bg-gray-50 border-b-2 border-transparent rounded-2xl focus:bg-white focus:border-blue-500 outline-none transition text-2xl font-bold text-blue-600 shadow-sm">
                    </div>
                </div>
            </div>

            <div id="imagePreviewContainer" class="hidden animate-pulse">
                <img id="imagePreview" src="#"
                    class="w-full h-52 object-cover rounded-2xl shadow-inner border border-gray-100">
            </div>

            <div>
                <label for="photo" class="custom-file-upload" id="fileLabel">
                    <i class="fas fa-camera text-blue-400 text-xl mb-1 block"></i>
                    <span class="text-gray-500 text-sm">é»æ“Šæ‹æ”æ”¶æ“šæˆ–é¸å–åœ–ç‰‡</span>
                </label>
                <input type="file" id="photo" accept="image/*" class="hidden">
            </div>

            <div class="pt-4 pb-8">
                <button type="submit" id="submitBtn"
                    class="w-full bg-blue-600 text-white font-bold py-5 rounded-[1.5rem] hover:bg-blue-700 active:scale-[0.96] transition-all shadow-xl shadow-blue-100 text-xl tracking-widest">
                    ç¢ºèªé€å‡º
                </button>
                <p id="status" class="text-center text-sm font-medium mt-4 hidden"></p>
            </div>
        </form>
    </div>

    <script>
        const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxFTjjCO16PTs8qm0fxSI3whb5z2-dRrHRzVsVdPVcHh7ZkxXNHvR3KwRzTZQPYYO28/exec';

        document.getElementById('date').valueAsDate = new Date();

        const photoInput = document.getElementById('photo');
        const previewImg = document.getElementById('imagePreview');
        const previewContainer = document.getElementById('imagePreviewContainer');
        const fileLabel = document.getElementById('fileLabel');

        photoInput.addEventListener('change', function () {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    previewImg.src = e.target.result;
                    previewContainer.classList.remove('hidden');
                    previewContainer.classList.remove('animate-pulse');
                    fileLabel.innerHTML = `<i class="fas fa-check-circle text-green-500 text-xl mb-1 block"></i><span class="text-green-600">å·²é¸å–åœ–ç‰‡</span>`;
                    fileLabel.classList.add('bg-green-50', 'border-green-200');
                }
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('expenseForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            const status = document.getElementById('status');

            btn.disabled = true;
            btn.innerHTML = `<i class="fas fa-circle-notch fa-spin mr-2"></i> ä¸Šå‚³ä¸­`;
            status.textContent = 'è«‹ç¨å€™...';
            status.className = 'text-center text-sm font-medium mt-4 text-blue-500';
            status.classList.remove('hidden');

            const data = {
                date: document.getElementById('date').value,
                category: document.getElementById('category').value,
                item: document.getElementById('item').value,
                amount: document.getElementById('amount').value,
                payment: document.getElementById('payment').value,
                imageName: '',
                imageBlob: null
            };

            if (photoInput.files.length > 0) {
                const file = photoInput.files[0];
                data.imageName = file.name;
                data.imageBlob = await new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result);
                    reader.readAsDataURL(file);
                });
            }

            try {
                await fetch(GAS_WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                status.innerHTML = `<i class="fas fa-check-circle mr-1"></i> å·²å„²å­˜è‡³ Google è©¦ç®—è¡¨`;
                status.className = 'text-center text-sm font-medium mt-4 text-green-600';

                document.getElementById('expenseForm').reset();
                document.getElementById('date').valueAsDate = new Date();
                previewContainer.classList.add('hidden');
                fileLabel.innerHTML = `<i class="fas fa-camera text-blue-400 text-xl mb-1 block"></i><span class="text-gray-500 text-sm">é»æ“Šæ‹æ”æ”¶æ“šæˆ–é¸å–åœ–ç‰‡</span>`;
                fileLabel.classList.remove('bg-green-50', 'border-green-200');

            } catch (error) {
                status.innerHTML = `<i class="fas fa-exclamation-circle mr-1"></i> é€£ç·šå¤±æ•—ï¼Œè«‹é‡è©¦`;
                status.className = 'text-center text-sm font-medium mt-4 text-red-600';
            } finally {
                btn.disabled = false;
                btn.innerHTML = `ç¢ºèªé€å‡º`;
            }
        });
    </script>
</body>

</html>
